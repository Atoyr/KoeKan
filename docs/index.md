# KoeKan
## はじめに
KoeKanは、ゲーム中にシームレスにDiscordのメッセージをやり取りしたいという思いを元に作られたメッセージ転送アプリです。
ゲーム中にコミュニケーションを取ることを目的としており、大きく2つの機能を提供します。

- Discordなどのコミュニケーションツールのメッセージを送受信する
- テキストを音声変換する

KoeKanは外部ツールに依存しています。そのため、利用者にて外部ツールのセットアップが必要となります。
簡易的なセットアップ方法は本ドキュメントに記載していますが、細かいセットアップ方法については各種ツールのドキュメントをご確認ください。
また、外部ツールの利用については各ツールの規約を守って使用してください。

## 機能
### Discordのテキストチャット取得・テキスト投稿
Discordのbotを使用してテキストチャットの取得・テキストの投稿ができます。
テキストチャットの取得はbotが参加しているサーバのすべてのテキストチャットを取得します。
> ⚠️将来的には取得するテキストチャットを絞り込む機能を追加する予定です

botを使用している関係で、サーバの管理者にbotを許可してもらう必要があります。

### Twitchのチャット取得・テキスト投稿
TwitchのAPIを利用してテキストチャットの取得・テキストの投稿ができます。
テキストチャットの取得は指定したユーザのチャットを取得します。複数のユーザのチャットを取得することも可能です。

### VOICEVOXを使ったTextToSpeak機能
VOICEVOXと連携することで、テキストを音声に変換できます。
自分の入力するテキストの他、DiscordやTwitchのテキストも音声に変換可能です。

VOICEVOXとの連携はVOICEVOXのWEP APIを利用しています。 VOICEVOXをあらかじめ起動させておくことで連携が可能です。

### ゲームウインドウ上に表示し、ホットキーで入力する
ゲーム中にシームレスに操作できるよう、画面の最上位に表示しています。
また、不用意にマウスカーソルがあってアクティブにならないようにするため、マウスが使用できない仕組みとなっています。
ホットキーを入力することでテキストボックスにカーソルが移り、テキストが入力できるようになります。

## インストール
KoeKanはexeのみ配布の形式です。
以下のURLからexeを取得して起動してください。

[KoeKan](https://github.com/Atoyr/KoeKan/releases/download/v1.0/Medoz.KoeKan.zip)

## 基本操作
KoeKanはゲーム中に操作することを想定しています。
そのため、通常のウィンドウとは動作が異なります。
操作するときはホットキーやコマンドを使用します。

### テキストの入力
テキストボックスへのホットキーは初期設定では`Ctrl + Enter`です。

### テキストボックスからアプリケーションに戻る
テキストボックスからアプリケーションに戻るときは`ESC`です。
戻る先のアプリケーションは事前に設定が必要です。
各種設定を参照してください。

### ウィンドウの移動
テキストボックスに`:window move`と入力することでウィンドウを移動できる状態となります。
移動後は再度`:window move`と入力することで、ウィンドウを固定します。

### ウィンドウサイズの変更
ウィンドウサイズは数値入力で設定します。
テキストボックスに`:window size {width} {height}`と入力することでウィンドウサイズが変更できます。
`{width}`と`{height}`は整数で、ピクセルを入力します。

ex: `:window size 380 400`

## セットアップ
KoeKanはUIを簡素にしているため、設定用のUIがありません。
代わりにテキストボックスにコマンドを入力することが可能です。
KoeKanとの連携箇所については、 コマンドを入力してセットアップします。

### Discord
DiscordはAPIを提供していない代わりにBotを使用することでサーバのメッセージを読み書きできます。
自分でBotを作成し登録するため、以下の制約があります。
- サーバ管理者にBotを許可してもらう必要があります。
- テキストを投稿する場合、Botが発言します。
- Botが参照できるテキストチャンネルのみメッセージが取得できます。
- 個人間チャットは取得できません。

1. Discordの開発者機能をONにします。
![Discordの開発機能をON](images/discord_1.png)
> 必須ではないですが、設定時に利用する場合があるので事前にONにするのがよいです。

1. Discordの開発者ポータルにアクセスします。
[Discord 開発者ポータル](https://discord.com/developers/applications)

1. applicationsの右側にある"New Application"ボタンをクリックする
![New Application](images/discord_3.png)

1. アプリケーション名を入力し、規約の同意チェックボックスをオンにし、アプリケーションを作成します。  アプリケーション名はBotの名前になるため、他の人が認識できる名前にするとよいです。
![Bot名を入力します](images/discord_4.png)

1. アプリケーションの設定ページから左側ペインのBotを選択し、ResetTokenをクリックします。  トークンが再発行されるので、メモしてください。
> トークンが漏洩するとBotに不正アクセスできる状態となります。トークンの管理には細心の注意を払ってください。
![トークンを取得します](images/discord_5.png)

1. 左側ペインのOAuth2 - URL Generatorをクリックします。
`SCOPE`で`Bot`を選択し、`BOT PERMISSION`で`SendMessage`と`Read Message History`を選択します。
生成されたURLをメモしてください。
![SCOPE](images/discord_6-1.png)
![BOT PERMISSION](images/discord_6-2.png)
![URL](images/discord_6-3.png)

1. メモしたURLをDiscord サーバの管理者に連絡し、Botをサーバに追加するよう依頼してください。
![Botの追加](images/discord_7.png)

1. KoeKanにDiscordのトークンを設定します。
KoeKanを起動し、`:w discord.token {Botのトークン}`と入力します。`{Botのトークン}`部分には先ほどメモしたトークンを入力してください。

1. KoeKanで`:discord start`と入力します。
`Discord is Ready`と表示されたらセットアップは完了です。

### Twitch
Twitchとの連携にはユーザの認証が必要となります。

1. `:twitch start`と入力し、Twitchとの連携を開始します。
未認証の場合は認証ダイアログが表示されるので、認証してください。
認証後にブランクページが表示されるので閉じます。
`Twitch is Ready`と表示されたらセットアップは完了です。

### VOICEVOX
VOICEVOXとの連携は、VOICEVOXに内蔵されているWEB APIを経由して行われます。

1. [VOICEVOX](https://voicevox.hiroshiba.jp/)をダウンロードして起動します。

1. KoeKanを起動し、`:voicevox start`と入力します。
`VOICEVOX is Ready`と表示されたらセットアップは完了です。


## 各種設定

### 設定の保存
認証情報以外の各種設定は以下のコマンドを使用します。
```
:w config
```

### ユーザ名の登録
入力したテキストを表示するときに表示するユーザ名です。
`:set usename {ユーザ名}`

### アイコン
入力したテキストのアイコンです。
`:set icon {アイコンのファイルパス}`

### VOICEVOXのキャラクター
VOICEVOXでどのキャラクターをしゃべらせるかの設定です。
`:set voicevox.speaker {スピーカーID}`

スピーカーIDはVOICEVOXを起動した後に以下URLで確認できます。
[http://localhost:50021/speakers](http://localhost:50021/speakers)

### 戻り先のアプリケーション
`ESC`を押したときに戻るアプリケーションです。
`:set application {アプリケーション名}`

アプリケーション名はexeのファイル名となります。
タスクマネージャーなどでアプリケーション名をしらべてください。
例：PAYDAY3 `PAYDAY3Client-Win64-Shipping`

## コマンド
> 割愛


